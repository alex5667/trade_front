# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–≤ –≤ Top Gainers, Top Losers –∏ Volume & Funding

## –ü—Ä–æ–±–ª–µ–º–∞

–í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö **Top Gainers**, **Top Losers** –∏ **Volume & Funding** —Å–∏–º–≤–æ–ª—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –º–æ–Ω–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö.

## –ü—Ä–∏—á–∏–Ω—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –î–≤–æ–π–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

- **SignalSocketInitializer** (–≤ layout) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `useSignalInitializer()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- **SignalTable** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–∞–∫–∂–µ –∏–º–µ–ª RTK Query —Ö—É–∫–∏ –∏ —Ä—É—á–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö
- –û–±–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é

### 2. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ Redux

- –°–ª–∞–π—Å—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ —Å–∏–º–≤–æ–ª—É –ø—Ä–∏ –∑–∞–º–µ–Ω–µ –¥–∞–Ω–Ω—ã—Ö
- –õ–æ–≥–∏–∫–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –±—ã–ª–∞ —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–æ–π (—Ç—Ä–µ–±–æ–≤–∞–ª–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∏ —Å–∏–º–≤–æ–ª–∞, –∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏)

### 3. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

- RTK Query —Ö—É–∫–∏ —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- WebSocket —Å–æ–±—ã—Ç–∏—è
- –†—É—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–∞–Ω–Ω—ã—Ö

## –†–µ—à–µ–Ω–∏–µ

### 1. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–£–¥–∞–ª–µ–Ω–æ –∏–∑ SignalTable:**

- RTK Query —Ö—É–∫–∏ (`useGetTopGainersQuery`, `useGetTopLosersQuery`, etc.)
- –†—É—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `signalApi.endpoints`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç

**–û—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ SignalSocketInitializer (layout):**

- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- RTK Query —Ö—É–∫–∏ —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å–∏–≥–Ω–∞–ª–æ–≤

### 2. –£–ª—É—á—à–µ–Ω–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ Redux

#### Timeframe Slice (Top Gainers/Losers)

```typescript
replaceTimeframeGainers: (
	state,
	action: PayloadAction<{ data: TimeframeCoin[] }>
) => {
	// Deduplicate gainers by symbol before replacing
	const uniqueGainers = (action.payload.data || []).reduce(
		(acc: TimeframeCoin[], coin) => {
			const existingIndex = acc.findIndex(c => c.symbol === coin.symbol)
			if (existingIndex === -1) {
				acc.push(coin)
			} else {
				// Update existing coin with newer data
				acc[existingIndex] = coin
			}
			return acc
		},
		[]
	)

	state.gainers = uniqueGainers
		.slice()
		.sort((a, b) => b.percentChange - a.percentChange)
		.slice(0, MAX_ITEMS)
}
```

#### Volume Slice

```typescript
addVolumeSignal: (state, action: PayloadAction<VolumeSignalPrisma>) => {
	const signal = action.payload

	// Check for existing signal by symbol only (not timestamp)
	const existingIndex = state.signals.findIndex(
		existingSignal => existingSignal.symbol === signal.symbol
	)

	if (existingIndex !== -1) {
		// Update existing signal instead of adding new one
		state.signals[existingIndex] = {
			...signal,
			createdAt: state.signals[existingIndex].createdAt
		}
	} else {
		// Add new signal
		state.signals.unshift({ ...signal, createdAt: new Date().toISOString() })
	}

	// Sort and limit array size
	state.signals = sortSignalsByVolume(state.signals)
	if (state.signals.length > MAX_SIGNALS) {
		state.signals.length = MAX_SIGNALS
	}
}
```

#### Funding Slice

```typescript
replaceFundingData: (state, action: PayloadAction<FundingCoin[]>) => {
	// Deduplicate funding data by symbol before replacing
	const uniqueCoins = (action.payload || []).reduce(
		(acc: FundingCoin[], coin) => {
			const existingIndex = acc.findIndex(c => c.symbol === coin.symbol)
			if (existingIndex === -1) {
				acc.push(coin)
			} else {
				// Update existing coin with newer data
				acc[existingIndex] = coin
			}
			return acc
		},
		[]
	)

	state.coins = uniqueCoins
		.slice()
		.sort((a, b) => Math.abs(b.rate) - Math.abs(a.rate))
		.slice(0, MAX_COINS)
}
```

### 3. –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

**useSignalInitializer:**

```typescript
// Track processed data to prevent duplicates
const processedDataRef = useRef<Set<string>>(new Set())

// Helper function to create a unique key for data
const createDataKey = (data: any, type: string) => {
	if (!data) return null
	const dataString = JSON.stringify(data)
	return `${type}-${dataString}`
}

// Check if data was already processed
const dataKey = createDataKey(topGainersData, 'gainers')
if (dataKey && !processedDataRef.current.has(dataKey)) {
	// Process data only once
	dispatch(replaceTimeframeGainers({ data: coins }))
	processedDataRef.current.add(dataKey)
}
```

### 4. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—ã:**

```typescript
// Debug logging to track data and detect duplicates
useEffect(() => {
	if (coins.length > 0) {
		const symbols = coins.map(coin => coin.symbol)
		const uniqueSymbols = new Set(symbols)
		if (symbols.length !== uniqueSymbols.size) {
			console.warn(`‚ö†Ô∏è Duplicate symbols detected in ${type}:`, {
				total: symbols.length,
				unique: uniqueSymbols.size,
				duplicates: symbols.filter(
					(symbol, index) => symbols.indexOf(symbol) !== index
				)
			})
		} else {
			console.log(`‚úÖ ${type} table: ${coins.length} unique symbols`)
		}
	}
}, [coins, type])
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:

1. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤** - –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
2. **–£–ø—Ä–æ—â–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
3. **–£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –Ω–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –¥–∞–Ω–Ω—ã—Ö
4. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –ª–µ–≥–∫–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```
Layout (SignalSocketInitializer)
‚îú‚îÄ‚îÄ useSignalInitializer() - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ RTK Query —Ö—É–∫–∏ —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
‚îî‚îÄ‚îÄ Redux store —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

SignalTable (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
‚îú‚îÄ‚îÄ –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Redux store
‚îú‚îÄ‚îÄ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
‚îî‚îÄ‚îÄ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:

- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –¥—É–±–ª–∏–∫–∞—Ç–∞—Ö (–µ—Å–ª–∏ –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è)
- üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –≤ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ
- üîÑ –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
